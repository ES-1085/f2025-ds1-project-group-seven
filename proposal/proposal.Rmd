---
title: "Project proposal"
author: "Damian, Matty, Hank, and Daniel"
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(readxl)
## Add any additional packages you are using here
```

## 1. Introduction

Our data comes from a dataset showcasing various variables regarding energy for each US state from 1960-2019 from the U.S. Energy Information Administration. Our data is specifically the 2019 data for each state from that dataset. The variables for energy cover the consumption, expenditure, and price of a variety of different energy sources and industries for each state. 

Research Question: 
- What are the overall trends that are shown in US energy consumption, expenditure, and price?
     (Per capita consumption, regional price, regional consumption, etc)
- How does the population in each state correlate with their consumption and expenditure of each energy source?


## 2. Data

Text goes here. Place your data in the /data folder, and add dimensions and codebook to the README in that folder. Then print out the output of glimpse() or skim() of your data frame.

```{r datawork}
setwd("/cloud/project")

energy <- read_csv("data/energy.csv")
filtered_energy <- energy %>%
  filter(Year == 2019) %>%
  select(State, Year, starts_with(c("Consumption", "Expenditure", "Price")))

population <- read_excel("data/Population.xlsx")
filtered_population <- population[c(-(1:8),-(60:66)),] %>%
  rename(Population = "...13",
         State = "table with row headers in column A and column headers in rows 3 through 4. (leading dots indicate sub-parts)") %>%
  mutate(State = substr(State, 2, nchar(State))) %>%
  select(State, Population)

joined <- filtered_energy %>%
  left_join(filtered_population, by = c("State" = "State"))

variables <- colnames(joined)
variables <- variables[-c(1:2,84)]

per_cap <- joined %>%
  mutate(across(variables, ~ .x / joined$Population))

for (var in variables) {
  per_cap[[paste0(var, "_pc")]] <- per_cap[[var]]
}

per_cap <- per_cap %>%
  select(State, Year, ends_with("pc"))

final <- joined %>%
  left_join(per_cap, by = c("State" = "State"))

# Print the output of glimpse() or skim()
glimpse(final)
```

## 3. Data analysis plan

The variables we will be exploring to answer our research questions include:

- `State`: Identifies the state where the data is collected and reported
- `Consumption.{industry}.{type}`: {type} consumed by the {industry} sector in billion BTU
- `Expenditure.{industry}.{type}`: {type} expenditures in the {industry} sector in million dollars
- `Price.{industry}.{type}`: {type} price in the {industry} sector in dollars per million BTU
- `Population`: Population of each state
- `Consumption.{industry}.{type}_pc`: {type} consumed by the {industry} sector in billion BTU per capita
- `Expenditure.{industry}.{type}_pc`: {type} expenditures in the {industry} sector in million dollars per capita
- `Price.{industry}.{type}_pc`: {type} price in the {industry} sector in dollars per million BTU per capita

We will be showcasing the relationships within our data with heatmaps of the entire USA where different colors/patterns correlate to varying amounts of consumption of the types of energy. Some of our visualizations will use population data to create consumption per capita and others will not, to see if a trend emerges. 

```{r prelim-data-analysis}

  ggplot(data = final, aes(x = Consumption.Commercial.Petroleum_pc, color = State)) +
  geom_histogram(bins = 20)
  ggplot(data = final, aes(x = Expenditure.Commercial.Petroleum_pc, color = State)) +
  geom_histogram(bins = 20)
  ggplot(data = final, aes(x = Price.Commercial.Petroleum_pc, color = State)) +
  geom_histogram(bins = 20)
```
