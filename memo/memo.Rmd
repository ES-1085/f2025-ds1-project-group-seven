---
title: "Project memo"
author: "Group 7"
output: github_document
---

This document should contain a detailed account of the data clean up for your data and the design choices you are making for your plots. For instance you will want to document choices you've made that were intentional for your graphic, e.g. color you've chosen for the plot. Think of this document as a code script someone can follow to reproduce the data cleaning steps and graphics in your handout.

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(readxl)
library(usmap)
```

## Data Clean Up Steps for Overall Data

### Step 1: Data Cleaning
We loaded, cleaned, and merged the energy and population datasets by state and included only the data from 2019. We then calculated per-capita values for all energy-related variables and added those new columns back into the main dataset. 

```{r}
setwd("/cloud/project")

energy <- read_csv("data/energy.csv")
filtered_energy <- energy %>%
  filter(Year == 2019) %>%
  select(State, Year, starts_with(c("Consumption", "Expenditure", "Price")))

population <- read_excel("data/Population.xlsx")
filtered_population <- population[c(-(1:8),-(60:66)),] %>%
  rename(Population = "...13",
         State = "table with row headers in column A and column headers in rows 3 through 4. (leading dots indicate sub-parts)") %>%
  mutate(State = substr(State, 2, nchar(State))) %>%
  select(State, Population)

joined <- filtered_energy %>%
  left_join(filtered_population, by = c("State" = "State"))

variables <- colnames(joined)
variables <- variables[-c(1:2,84)]

per_cap <- joined %>%
  mutate(across(variables, ~ .x / joined$Population))

for (var in variables) {
  per_cap[[paste0(var, "_pc")]] <- per_cap[[var]]
}

per_cap <- per_cap %>%
  select(State, Year, ends_with("pc"))

final <- joined %>%
  left_join(per_cap, by = c("State" = "State"))

# Print the output of glimpse() or skim()
glimpse(final)
```

### Step 2: Visualizations

#### Final Plot 
For this first plot, we started by adding a lowercase state column to ensure that the data aligns with the mapping package’s format. This plot then showcases a U.S. map shaded by each state’s commercial petroleum consumption, using a gradient to highlight differences in energy use. The plot is able to show when commerical petroleum is consumed the most. 

```{r creat_map_petroleum, warning=FALSE}
final <- final %>%
  mutate(state = State)

plot_usmap(
  linewidth = 0.1,
  color = "white",
  regions = "state",
  data = final,
  values = 'Consumption.Commercial.Petroleum'
) +
  scale_fill_gradient(
    labels = scales::label_number(big.mark = ','),
    high = 'brown',
    low = 'white'
  ) +
  labs(fill = 'Consumption (Billions BTU)',
       title = "Commercial Petroleum Consumption by State Across U.S.A.") +
  guides(
    fill = guide_colorbar(barwidth = unit(8, 'cm'))
  ) +
  theme(
    legend.position = 'top',
    plot.title = element_text(hjust = 0.5)  # <-- Center the title
  )
```


### Plot 2: _________

### Plot 3: ___________

Add more plot sections as needed. Each project should have at least 3 plots, but talk to me if you have fewer than 3.

### Plot 4: ___________ 

